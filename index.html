<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tiren Parleys â€” Consejos del Mago (Completo)</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>

  <!-- API-Sports widgets -->
  <script type="module" crossorigin src="https://widgets.api-sports.io/3.1.0/widgets.js"></script>

  <style>
    :root{--bg:#071019;--card:#0b1720;--muted:#91a6b0}
    body{background:var(--bg);color:#e6eef6;font-family:Inter,system-ui,Arial,sans-serif;margin:0}
    .container-max{max-width:1440px;margin:auto;padding:14px}
    .bubble{background:linear-gradient(180deg,#071726,#081a22);border:1px solid #123140;border-radius:12px;padding:12px;margin-bottom:10px;box-shadow:0 6px 18px rgba(0,0,0,.45)}
    .muted{color:var(--muted);font-size:.92rem}
    .btn-small{padding:.35rem .6rem;font-size:.85rem}
    .team-select{width:100%;margin-top:6px}
    .fav-btn{background:#ffb86b;border:none;color:#06121a;padding:.25rem .5rem;border-radius:6px;cursor:pointer}
    .fav-btn.saved{background:#ffd89e;color:#06121a}
    .sidebar-card{max-height:65vh;overflow:auto}
    .topbar{background:#05121a;padding:10px 14px;display:flex;align-items:center;gap:12px}
    .logo{font-weight:700}
    .small-muted{font-size:.85rem;color:var(--muted)}
    .settings-box{background:#071622;padding:10px;border-radius:8px;border:1px solid #123140}
    .flex-gap{display:flex;gap:8px}

    /* Layout mÃ³vil por defecto si se detecta */
    body.mobile .row {
        flex-direction: column !important;
    }
    body.mobile .sidebar-card {
        max-height:40vh;
    }
    body.mobile .col-md-5, body.mobile .col-md-4 {
        width:100%;
    }

    @media (max-width:767px){
        .row-gap{display:flex;flex-direction:column}
    }
  </style>
</head>
<body>
  <!-- Top bar -->
  <div class="topbar">
    <div class="logo">Tiren Parleys</div>
    <div class="small-muted ms-auto">v1.2 â€” Completo</div>
  </div>

  <div class="container-max">
    <div class="row g-3">
      <!-- LEFT: Leagues -->
      <div class="col-12 col-md-3">
        <div class="card sidebar-card text-bg-dark border-0">
          <div class="card-body p-2">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div style="font-weight:700">Ligas</div>
              <div class="muted" id="current-sport-label">football</div>
            </div>
            <div id="leagues-list" class="p-0">
              <api-sports-widget data-type="leagues"></api-sports-widget>
            </div>

            <hr class="my-2">

            <div style="font-weight:700;margin-bottom:6px">ConfiguraciÃ³n IA (opcional)</div>
            <div class="settings-box">
              <div class="mb-2 small-muted">Pega tu OpenRouter API Key para activar respuestas conversacionales (opcional):</div>
              <input id="openrouter-key" class="form-control form-control-sm mb-2" placeholder="Si la tienes, pÃ©gala aquÃ­">
              <div class="d-flex gap-2">
                <button id="save-key" class="btn btn-sm btn-outline-light">Guardar key</button>
                <button id="clear-key" class="btn btn-sm btn-outline-secondary">Borrar key</button>
              </div>
              <div class="mt-2 small-muted">Si no pones key, los consejos se generan con reglas automÃ¡ticas (funciona igual).</div>
            </div>
          </div>
        </div>
      </div>

      <!-- CENTER: Games + Mago -->
      <div class="col-12 col-md-5">
        <div class="card text-bg-dark border-0 mb-3">
          <div class="card-body p-0" id="games-widget-area">
            <api-sports-widget data-type="games"></api-sports-widget>
          </div>
        </div>

        <!-- Consejos Mago -->
        <div class="card text-bg-dark border-warning mb-3">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div style="font-weight:700">ðŸ§™ Consejos del Mago</div>
            <div class="muted">AutomÃ¡tico + IA</div>
          </div>

          <div class="card-body">
            <div class="d-flex gap-2 mb-2 row-gap">
              <button id="btn-live" class="btn btn-success btn-small w-50">ðŸ”´ En Vivo</button>
              <button id="btn-future" class="btn btn-primary btn-small w-50">ðŸŸ¢ PrÃ³ximos</button>
            </div>

            <div class="d-flex gap-2 align-items-center mb-2">
              <select id="team-filter" class="form-select team-select">
                <option value="">â€” Filtrar por equipo (opcional) â€”</option>
              </select>
              <button id="btn-refresh" class="btn btn-outline-light btn-small">Actualizar</button>
            </div>

            <div id="mago-output" style="min-height:140px">
              <p class="muted">Pulsa "En Vivo" o "PrÃ³ximos" para cargar consejos automÃ¡ticos segÃºn el deporte.</p>
            </div>

            <div class="mt-3 d-flex justify-content-between align-items-center">
              <small class="muted">Favoritos</small>
              <div>
                <button id="clear-fav" class="btn btn-sm btn-outline-secondary">Limpiar</button>
              </div>
            </div>
            <div id="favorites-list" class="mt-2"></div>
          </div>
        </div>

      </div>

      <!-- RIGHT: standings/team/game -->
      <div class="col-12 col-md-4">
        <div class="card text-bg-dark border-0 mb-3">
          <div class="card-body p-0">
            <div id="standings-content"></div>
          </div>
        </div>

        <div class="card text-bg-dark border-0 mb-3">
          <div class="card-body p-0">
            <div id="team-content"></div>
          </div>
        </div>

        <div class="card text-bg-dark border-0 mb-3">
          <div class="card-body p-0">
            <div id="game-content">
              <api-sports-widget data-type="game"></api-sports-widget>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Config widget -->
  <api-sports-widget
    data-type="config"
    data-key="5d336df03a293338648ef0478999076c"
    data-sport="football"
    data-lang="en"
    data-theme="dark"
    data-show-error="false"
    data-show-logos="true"
    data-refresh="30"
    data-favorite="true"
    data-player-trophies="true"
    data-standings="true"
    data-player-injuries="true"
    data-team-squad="true"
    data-team-statistics="true"
    data-player-statistics="true"
    data-tab="games"
    data-game-tab="statistics"
    data-target-player="modal"
    data-target-league="#games-widget-area"
    data-target-team="#team-content"
    data-target-game="#game-content .card-body"
    data-target-standings="#standings-content">
  </api-sports-widget>

<script>
/* ================== Detectar dispositivo ================== */
function detectDevice() {
    const ua = navigator.userAgent;
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
    if (isMobile) {
        document.body.classList.add('mobile');
        console.log('Modo mÃ³vil activado');
    } else {
        document.body.classList.add('desktop');
        console.log('Modo escritorio activado');
    }
}
detectDevice();

/* ================== CÃ³digo JS unificado ================== */
const API_KEY = "5d336df03a293338648ef0478999076c";
let currentSport = "football";
const magoOutput = document.getElementById('mago-output');
const teamFilter = document.getElementById('team-filter');
const favoritesList = document.getElementById('favorites-list');

// Endpoints por deporte
const ENDPOINTS = { football:{host:"v3.football.api-sports.io",live:"https://v3.football.api-sports.io/fixtures?live=all",upcoming:"https://v3.football.api-sports.io/fixtures?status=NS&next=30"}, basketball:{host:"v1.basketball.api-sports.io",live:"https://v1.basketball.api-sports.io/games?live=all",upcoming:"https://v1.basketball.api-sports.io/games?next=30"}, tennis:{host:"v1.tennis.api-sports.io",live:"https://v1.tennis.api-sports.io/matches?live=all",upcoming:"https://v1.tennis.api-sports.io/matches?status=NS&next=30"}, hockey:{host:"v1.hockey.api-sports.io",live:"https://v1.hockey.api-sports.io/matches?live=all",upcoming:"https://v1.hockey.api-sports.io/matches?status=NS&next=30"}, baseball:{host:"v1.baseball.api-sports.io",live:"https://v1.baseball.api-sports.io/games?live=all",upcoming:"https://v1.baseball.api-sports.io/games?next=30"}, volleyball:{host:"v1.volleyball.api-sports.io",live:"",upcoming:""}, handball:{host:"v1.handball.api-sports.io",live:"",upcoming:""}};

function get(o,p,d=null){ try{ return p.split('.').reduce((a,b)=> a && a[b]!==undefined?a[b]:null,o)??d }catch(e){return d} }

// ---------------- Favorites ----------------
function loadFavorites(){ const f = JSON.parse(localStorage.getItem('tiren_favs')||'[]'); renderFavorites(f); }
function saveFavorite(item){ const f = JSON.parse(localStorage.getItem('tiren_favs')||'[]'); f.unshift(item); localStorage.setItem('tiren_favs', JSON.stringify(f.slice(0,50))); renderFavorites(f); }
function removeFav(i){ const f = JSON.parse(localStorage.getItem('tiren_favs')||'[]'); f.splice(i,1); localStorage.setItem('tiren_favs', JSON.stringify(f)); renderFavorites(f); }
function renderFavorites(list){ favoritesList.innerHTML=''; if(!list.length){ favoritesList.innerHTML='<div class="muted">No hay favoritos</div>'; return;} list.slice(0,10).forEach((it,i)=>{ const div=document.createElement('div'); div.className='d-flex justify-content-between align-items-center bubble'; div.innerHTML=`<div><strong>${it.title}</strong><div class="muted">${it.subtitle}</div></div><div><button class="fav-btn saved" onclick="removeFav(${i})">Quitar</button></div>`; favoritesList.appendChild(div); }); }

// --------------- Fetch helper ----------------
async function fetchApi(url, host=null){ const headers = {"x-apisports-key":API_KEY}; if(host) headers["x-rapidapi-host"]=host; const res=await fetch(url,{headers}); return res.json(); }

// ------------- Render helpers -------------
function renderFootballCard(m){ const home=get(m,'teams.home.name','Home'), away=get(m,'teams.away.name','Away'); const goalsH=get(m,'goals.home',0), goalsA=get(m,'goals.away',0); return {title:`${home} vs ${away}`, subtitle:`Goles ${goalsH}-${goalsA}`, html:`<div style="font-weight:700">${home} vs ${away}</div><div class="muted">Goles: ${goalsH}-${goalsA}</div>`}; }
function renderBasketballCard(m){ const home=get(m,'home.name')||get(m,'teams.home.name','Home'), away=get(m,'away.name')||get(m,'teams.away.name','Away'), ptsH=get(m,'scores.home', get(m,'points.home',0)), ptsA=get(m,'scores.away', get(m,'points.away',0)); return {title:`${home} vs ${away}`, subtitle:`Puntos ${ptsH}-${ptsA}`, html:`<div style="font-weight:700">${home} vs ${away}</div><div class="muted">Puntos: ${ptsH}-${ptsA}</div>`}; }
function renderTennisCard(m){ const p1=get(m,'players[0].player.name','Player1'), p2=get(m,'players[1].player.name','Player2'); return {title:`${p1} vs ${p2}`, subtitle:'Revisar superficie y forma', html:`<div style="font-weight:700">${p1} vs ${p2}</div><div class="muted">Ver aces, dobles faltas y sets</div>`}; }
function renderHockeyCard(m){ const home=get(m,'teams.home.name','Home'), away=get(m,'teams.away.name','Away'); const gH=get(m,'goals.home',0), gA=get(m,'goals.away',0); return {title:`${home} vs ${away}`, subtitle:`Goles ${gH}-${gA}`, html:`<div style="font-weight:700">${home} vs ${away}</div><div class="muted">Goles: ${gH}-${gA}</div>`}; }
function renderBaseballCard(m){ const home=get(m,'teams.home.name','Home'), away=get(m,'teams.away.name','Away'), rH=get(m,'score.fulltime.home', get(m,'scores.home',0)), rA=get(m,'score.fulltime.away', get(m,'scores.away',0)); return {title:`${home} vs ${away}`, subtitle:`Carreras ${rH}-${rA}`, html:`<div style="font-weight:700">${home} vs ${away}</div><div class="muted">Carreras: ${rH}-${rA}</div>`}; }

// ---------------- Core: cargar partidos ----------------
async function loadMatches(live=true){
  magoOutput.innerHTML='<div class="muted">Cargando partidos y recomendaciones...</div>';
  const endpoints=ENDPOINTS[currentSport]; if(!endpoints){ magoOutput.innerHTML='<div class="muted">Deporte no soportado aÃºn.</div>'; return; }
  const url=live?endpoints.live:endpoints.upcoming;
  try{
    const res=await fetchApi(url,endpoints.host);
    const list=res.response||res.data||res.results||[];
    if(!list.length){ magoOutput.innerHTML='<div class="muted">No hay partidos disponibles.</div>'; return; }
    magoOutput.innerHTML='';
    list.slice(0,10).forEach(m=>{
      let card; if(currentSport==='football') card=renderFootballCard(m); else if(currentSport==='basketball') card=renderBasketballCard(m); else if(currentSport==='tennis') card=renderTennisCard(m); else if(currentSport==='hockey') card=renderHockeyCard(m); else if(currentSport==='baseball') card=renderBaseballCard(m); else card={title:'Partido',subtitle:'Info',html:JSON.stringify(m).slice(0,200)};
      const wrapper=document.createElement('div'); wrapper.className='bubble';
      wrapper.innerHTML=`${card.html}<div class="mt-2 d-flex justify-content-between"><div class="muted">${card.subtitle}</div><div><button class="btn btn-sm btn-outline-light me-1" onclick="sharePick('${card.title}')">Compartir</button><button class="fav-btn" onclick="saveThisFav('${card.title}','${card.subtitle}')">Favorito</button></div></div>`;
      magoOutput.appendChild(wrapper);
    });
  }catch(e){ console.error(e); magoOutput.innerHTML='<div class="muted">Error al consultar API.</div>'; }
}

// ---------------- UI helpers ----------------
window.saveThisFav=(t,s)=>{ saveFavorite({title:t,subtitle:s}); loadFavorites(); };
window.sharePick=(t)=>{ alert('Compartir (simulado): '+t); };

document.getElementById('btn-live').addEventListener('click',()=>loadMatches(true));
document.getElementById('btn-future').addEventListener('click',()=>loadMatches(false));
document.getElementById('btn-refresh').addEventListener('click',()=>loadMatches(true));
document.getElementById('clear-fav').addEventListener('click',()=>{localStorage.removeItem('tiren_favs'); loadFavorites();});

loadFavorites();
setTimeout(()=>{ loadMatches(true); },600);
</script>
</body>
</html>
